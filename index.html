<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>UNDP Extractive Industries Data Dive</title>

    <!-- Load c3.css Style -->
    <link href="css/c3.css" rel="stylesheet" type="text/css">

    <!-- Bootstrap Style -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  
  <style>

    #chart2 .c3-line-econ_gdpcon {
      stroke-width: 0px;
    }
    #chart2 .c3-line-econ_gdpconpc {
      stroke-width: 0px;
    }
    #chart2 .c3-line-econ_tax {
      stroke-width: 0px;
    }
    #chart2 .c3-line-rev_gov_resrev_govtrev {
      stroke-width: 4px;
    }
    #chart2 .c3-line-rev_gov_resrev_gdp {
      stroke-width: 4px;
    }
    #chart2 .c3-line-rev2_gov_nonresrev_gdp {
      stroke-width: 4px;
    }
    #chart2 .c3-line-rev2_gov_resrev_gdp {
      stroke-width: 4px;
    }
    #chart2 .c3-line-rev2_gov_rev_gdp {
      stroke-width: 4px;
    }
    #chart2 .c3-line-rent_total {
      stroke-width: 4px;
    }
    #chart2 .legend {
      width: 300px;
    }
  
</style>
  </head>
  <body>

    <!-- For D3 -->
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <!-- For TopoJSON and DataMaps -->
    <script src='http://d3js.org/topojson.v1.min.js' type='text/javascript'></script>
    <script src='http://datamaps.github.io/scripts/datamaps.all.min.js' type='text/javascript'></script>
    <!-- Load c3.js -->
    <script src="http://c3js.org/js/c3.min-631d1d50.js"></script>
    <!-- Load angular.js -->
    <script src='http://cdnjs.cloudflare.com/ajax/libs/angular.js/1.2.1/angular.min.js' type='text/javascript'></script>

    <!-- Main jumbotron for a primary marketing message or call to action -->
    <div class="jumbotron">
      <div class="container">
        <h1>Extractive Industries and Development</h1>
        <p>How are countries transforming natural capital into economic and human development?</p>
      </div>
    </div>

    
    <!-- Set up our Bootstrap Layout Grid -->
    <div class="container">
      <div class="row">
        <div class="col-md-2 text-left"><h3>The Countries</h3>Resource dependence, resource wealth, and the disrtibution of that wealth vary widely across countries, and by type of country.
          Click on country, or select a group.
        </div> 
        <div class="col-md-10 text-left" style="height: 350px;"><div id='chart1'></div></div> 
      </div>
      
      <div class="row">      
        <div class="col-md-12 text-left"><div id='chart2'></div></div> 
      </div>
      
      <div class="row">      
        <div class="col-md-12 text-left">
        <p>
        <h3>REMOVE THIS</h3>
          Right now if you click on a country the line graph should update.  Right now all countries are clickable, even if we don't have Resource/Rent data etc - I would change that.<p>
My thought with the line graph was to show all the Resource/Rent data as colored lines and have a gray area background that is one of a selection of country-specific "macroeconomic indicators", such as GDP or INflation. <p>
The actual value of the indicator wouldn't matter much (ie there is no second axis), just the shape to put the resourece numbers in perspective.  Originally I thought we could have a bunch of different 
macro indicators (only of these could be selected at any given time), but the graph started to get wonky and I decided to just hide the others, so not sure if I can do that - maybe we just go with GDP.
<p>
Right Below the "The Countries" text I thought we could put buttons or links for "High Income", "Low Income", "Gas", etc.  When the user clicked on one either (1) those countries would be highlighted on the map and
then the user could click them to see data in line graph or (2) those countries would be selected on the map, and the data in line graph would be an average of all countries.   Either way, countries would be highlighted in
the same color.
<p>Right now there is no data being fed into the map -- I think creating another set of JSON objects that just have keys for classifications would probably be the simplest way to do this - we can than use this
to highlight/select the appropriate group.
<p>
Some of the Issues Right now: <p></p>
1) The page works but if you open the JavaScript console there are svg errors. This just  started happening and I'm not sure why, I've seen some  issues in the C3 forum on this, I need to follow up.  
It wasn't doing this last evening, ick. <p>
2) I want to use Angular to handle the "communication" between the charts (as Ben did originally) and to load the data, need to get that in.  <p>
3) Lots of visual improvements are needed.<p>
4) I don't have government take as one of the vars, oy! Need to add that.
<p>
My main thought was that we could create one or two JavaScript "data" objects that have global scope (either in plain JavaScript or in Angular) and then any additional visualization has the data right there
if it needs it.  Not sure it will work out that way, though.
          
        </div></div> 
      </div>
      
    </div>


    
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <!-- <script src="http://code.jquery.com/jquery.js"></script> -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>
    
    <script>
    
    // ----------------------------------------------------------------------
    // This is Angular Setup
    // ----------------------------------------------------------------------
  
    var eidata = [];
    var selected_country_id = null;
    var countryData = Object();

    //var varnames = [];
    var lastMacroIndex = 6;
    var xaxis = ["x","2000", "2001","2002","2003","2004","2005","2006","2007","2008","2009","2010","2011"]
    
    var chart2;
    var chart1;
    
    //var eimod = angular.module('EImodule',[]);  
/*    
    eimod.factory("selected_data", function() {
      
      d3.json("eidata.json", function(data) {
        //console.log(data);  
        //eidata = data;
        return data;
      
      });

*/

      d3.json("eidata.json", function(data) {
        //console.log(data);  
        eidata = data;
        //console.log(eidata.length);
        
        /*
        var i=0;
        for (var name in eidata[0].stat) {
          if (i < 6) {
                  varnames.push(name + " : 'y2'");
               }    
               else 
                varnames.push(name + " : 'y'");
          i++;
        }
        */

        for (var i = 0; i< eidata.length;  i++) {
        //console.log(eidata[i]);
        
          var statData = Object();
  
          countryData[eidata[i].ccode] = [];
          countryData[eidata[i].ccode].push(xaxis);
  
          for (var name in eidata[i].stat) {
              //console.log(name);
              var tmp=[];
              tmp.push(name);
              statData[name] = tmp.concat(eidata[i].stat[name].slice(1));
              countryData[eidata[i].ccode].push(statData[name]);
              
          }
        }
      
 
        selected_country_id = "AGO";
        //console.log("hi");    
        chart2 = c3.generate({
          
              bindto: '#chart2',
              
              size: {
                height: 280,
              },        
              
              data: {
                x: 'x',
                columns: countryData[selected_country_id],
                axes: { econ_gdpcon : 'y2',econ_gdpconpc : 'y2',econ_tax : 'y2',econ_govrev : 'y2',econ_govexp : 'y2',econ_invtotal : 'y2',rev_gov_resrev_govtrev : 'y',rev_gov_resrev_gdp : 'y',rev2_gov_nonresrev_gdp : 'y',rev2_gov_resrev_gdp : 'y',rev2_gov_rev_gdp : 'y',rent_total : 'y'},
                type: 'line',
                types: {
                    econ_gdpcon: 'area',
                    econ_gdpconpc: 'area',
                    econ_tax: 'area',
                    econ_govrev: 'area',
                    econ_govexp: 'area',
                    econ_invtotal: 'area',        
                },
                names: {
                  econ_gdpcon: 'GDP (constant $)',
                  econ_gdpconpc: 'GDP per capita (constant $)',
                  econ_tax: 'Total Govt Tax Rev (% GDP)',
                  econ_govrev: 'Total Govt Rev (% GDP) [econ]',
                  econ_govexp: 'Total Govt Expenditure (% GDP)',
                  econ_invtotal: 'Total Investments (% GDP)',
                  rev_gov_resrev_govtrev: 'Govt Res Rev. (% Govt Rev.)',
                  rev_gov_resrev_gdp: 'Govt Res Rev. (% GDP) [rev]',
                  rev2_gov_nonresrev_gdp: 'Govt Non-Res Rev. (% GDP)', 
                  rev2_gov_resrev_gdp: 'Govt Res Rev. (% GDP) [rev2]',
                  rev2_gov_rev_gdp: 'Govt Rev. (% GDP) [rev2]',
                  rent_total: 'Total Rent (% GDP)'                  
                },
                colors: {
                  econ_gdpcon: '#B6B6B4',
                  econ_gdpconpc: '#B6B6B4',
                  econ_tax: '#B6B6B4',
                  econ_govrev: '#B6B6B4',
                  econ_govexp: '#B6B6B4',
                  econ_invtotal: '#B6B6B4',                  
                },
              }, // data  
              axis: {
                x: {
                    type: 'timeseries',
                    tick: {
                        format: '%Y'
                    }
                },
                y: {
                  label: {
                    text: 'Resource Statistics: % of GDP',
                    position: 'outer-middle'
                  },
                },
            
              }, // axis
          
             legend: {
                position: 'right'
              },
              
      });
      chart2.unload(['econ_gdpconpc', 'econ_tax', 'econ_govrev','econ_govexp','econ_invtotal']);      
      
      });  

    
    function eicontrol($scope) {
      
    }
    
    </script>
    
    
    <script>

      // ----------------------------------------------------------------------
      // This generates the Map
      // ----------------------------------------------------------------------
      
      var width = $( window ).width();
      var height = $( window ).height();

      
      var chart1 = new Datamap({
          element: document.getElementById('chart1'),
          scope: "world",
          fills: {
            defaultFill: "#eee",
            selectable: "#fa0fa0",
            selected: "#fa0fa0",
          },
          "done": function(datamap) {

              datamap.svg.selectAll('.datamaps-subunit').on('click', function(geography, data) {
              cid = geography.id;
              alert(cid);
              selected_country_id = cid;
              chart2.load({ columns: countryData[selected_country_id] });
              chart2.unload(['econ_gdpconpc', 'econ_tax', 'econ_govrev','econ_govexp','econ_invtotal']);      

              //country = dataPack[cid];
              });
          }    
      });





    </script>

    <script>
/*
      // ----------------------------------------------------------------------
      // This generates the Chart with Individual country data
      // OLD
      // ----------------------------------------------------------------------

  var chart2 = c3.generate({
        bindto: '#chart2',
        size: {
          height: 300,
        },
  
        data: {
          columns: $scope.countryts,
        }
      });
      */
    </script>


  </body>
</html>
